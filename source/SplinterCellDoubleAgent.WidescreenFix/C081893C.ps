//
// Generated by Microsoft (R) D3DX9 Shader Compiler 9.12.589.0000
//
// Parameters:
//
//   sampler2D DiffuseTex;
//   sampler2D GI_Lightmap;
//   samplerCUBE NorAndAttenu;
//   sampler2D NormalMap;
//   sampler2D ShadowMap;
//   sampler2D SpecularMask;
//   sampler2D Spot0Tex;
//   sampler2D Spot1Tex;
//   sampler2D SpotAttenuTex;
//   sampler2D StaticShadowMap;
//   float4 g_GILM_Reflective_Gamma;
//   float4 g_GILM_TexCoordScale;
//   float4 g_psDiffuse0;
//   float4 g_psDiffuse1;
//   float4 g_psDiffuse2;
//   float4 g_psDiffuse3;
//   float4 g_psDiffuseTexScale;
//   bool g_psEnableFog;
//   bool g_psEnableOnmi0;
//   bool g_psEnableOnmi1;
//   bool g_psEnableOnmi2;
//   bool g_psEnableOnmi3;
//   bool g_psEnableShadow0;
//   bool g_psEnableShadow1;
//   bool g_psEnableSpecular;
//   bool g_psEnableSpecular0;
//   bool g_psEnableSpecular1;
//   bool g_psEnableSpecular2;
//   bool g_psEnableSpecular3;
//   bool g_psEnableSpot0;
//   bool g_psEnableSpot1;
//   float4 g_psFog;
//   float4 g_psScreenDimension;
//   float4 g_psShadowUsing;
//   float4 g_psSpecular0;
//   float4 g_psSpecular1;
//   float4 g_psSpecular2;
//   float4 g_psSpecular3;
//   float4 g_psSpecularStrength;
//   float4 g_psTiling;
//
//
// Registers:
//
//   Name                    Reg   Size
//   ----------------------- ----- ----
//   g_psEnableOnmi0         b0       1
//   g_psEnableOnmi1         b1       1
//   g_psEnableOnmi2         b2       1
//   g_psEnableOnmi3         b3       1
//   g_psEnableSpot0         b4       1
//   g_psEnableSpot1         b5       1
//   g_psEnableSpecular0     b8       1
//   g_psEnableSpecular1     b9       1
//   g_psEnableSpecular2     b10      1
//   g_psEnableSpecular3     b11      1
//   g_psEnableSpecular      b12      1
//   g_psEnableFog           b13      1
//   g_psEnableShadow0       b14      1
//   g_psEnableShadow1       b15      1
//   g_psSpecularStrength    c1       1
//   g_psDiffuse0            c3       1
//   g_psDiffuse1            c4       1
//   g_psDiffuse2            c5       1
//   g_psDiffuse3            c6       1
//   g_psSpecular0           c7       1
//   g_psSpecular1           c8       1
//   g_psSpecular2           c9       1
//   g_psSpecular3           c10      1
//   g_psFog                 c12      1
//   g_psShadowUsing         c15      1
//   g_psTiling              c16      1
//   g_psDiffuseTexScale     c17      1
//   g_GILM_TexCoordScale    c210     1
//   g_GILM_Reflective_Gamma c211     1
//   g_psScreenDimension     c220     1
//   DiffuseTex              s0       1
//   NormalMap               s1       1
//   SpecularMask            s2       1
//   NorAndAttenu            s3       1
//   SpotAttenuTex           s4       1
//   Spot0Tex                s5       1
//   Spot1Tex                s6       1
//   GI_Lightmap             s12      1
//   StaticShadowMap         s13      1
//   ShadowMap               s15      1
//
//
// Default values:
//
//   g_psEnableOnmi0
//     b0   = false;
//
//   g_psEnableOnmi1
//     b1   = false;
//
//   g_psEnableOnmi2
//     b2   = false;
//
//   g_psEnableOnmi3
//     b3   = false;
//
//   g_psEnableSpot0
//     b4   = false;
//
//   g_psEnableSpot1
//     b5   = false;
//
//   g_psEnableSpecular0
//     b8   = false;
//
//   g_psEnableSpecular1
//     b9   = false;
//
//   g_psEnableSpecular2
//     b10  = false;
//
//   g_psEnableSpecular3
//     b11  = false;
//
//   g_psEnableSpecular
//     b12  = false;
//
//   g_psEnableFog
//     b13  = false;
//
//   g_psEnableShadow0
//     b14  = false;
//
//   g_psEnableShadow1
//     b15  = false;
//
//   g_psSpecularStrength
//     c1   = { 0, 0, 0, 0 };
//
//   g_psDiffuse0
//     c3   = { 0, 0, 0, 0 };
//
//   g_psDiffuse1
//     c4   = { 0, 0, 0, 0 };
//
//   g_psDiffuse2
//     c5   = { 0, 0, 0, 0 };
//
//   g_psDiffuse3
//     c6   = { 0, 0, 0, 0 };
//
//   g_psSpecular0
//     c7   = { 0, 0, 0, 0 };
//
//   g_psSpecular1
//     c8   = { 0, 0, 0, 0 };
//
//   g_psSpecular2
//     c9   = { 0, 0, 0, 0 };
//
//   g_psSpecular3
//     c10  = { 0, 0, 0, 0 };
//
//   g_psFog
//     c12  = { 0, 0, 0, 0 };
//
//   g_psShadowUsing
//     c15  = { 0, 0, 0, 0 };
//
//   g_psTiling
//     c16  = { 0, 0, 0, 0 };
//
//   g_psDiffuseTexScale
//     c17  = { 0, 0, 0, 0 };
//
//   g_GILM_TexCoordScale
//     c210 = { 0, 0, 0, 0 };
//
//   g_GILM_Reflective_Gamma
//     c211 = { 0, 0, 0, 0 };
//
//   g_psScreenDimension
//     c220 = { 0, 0, 0, 0 };
//

    ps_3_0
    def c0, 0.5, -0.5, 0.500390649, 0.500694454
    def c2, 2, -1, -0, -0.5
    def c11, 255, -127, 0, 0

    ; NEW: brightness multiplier ONLY for the b1 light
    def c216, 3.0, 0, 0, 0

    dcl_texcoord v0
    dcl_texcoord1 v1.xy
    dcl_texcoord2 v2
    dcl_texcoord3 v3
    dcl_texcoord4 v4
    dcl_texcoord5 v5
    dcl_texcoord6 v6
    dcl_texcoord7 v7
    dcl_color v8.xw
    dcl_2d s0
    dcl_2d s1
    dcl_2d s2
    dcl_cube s3
    dcl_2d s4
    dcl_2d s5
    dcl_2d s6
    dcl_2d s12
    dcl_2d s13
    dcl_2d s15

    abs r1.w, c15.z
    mul r0.xy, v7, c16.w
    texld r0, r0, s13
    rcp r0.w, v8.w
    mul r1.xy, r0.w, v7.zwzw
    cmp r0.w, -r1.w, r0.y, r0.z
    mad r1.xy, r1, c0, c0.zwzw
    cmp r1.w, c15.z, r0.w, r0.x
    mul r0.xy, r1, c220
    texld r0, r0, s15
    add r0.z, r1.w, r0.z
    mad r0.z, c2.x, v8.x, r0.z
    min r3.w, r0.w, r0.z

    texld r0, v0.zwzw, s1
    mad r1.xyz, c2.x, r0, c2.y

    if b12
      nrm r0.xyz, v2
      dp3 r2.w, r1, r0
      mad r1.w, r0.w, c1.z, c1.w
      add r0.w, r2.w, r2.w
      mad r2.xyz, r0.w, r1, -r0
    else
      mov r2.yzw, c2.z
      mov r2.xyz, r2.wyzw
      mov r1.w, r2.w
    endif

    if b0
      texld r0, v3, s3
      mul r3.xyz, v3, -c2.yyww
      nrm r0.xyz, r3
      dp3 r2.w, r1, r0
      min r3.x, r2.w, -c2.y
      min r3.y, c16.z, r2_abs.w
      mad_sat r3.z, r0.w, v3.w, c3.w
      cmp r0.w, -r2.w, r3.y, r3.x
      mul_sat r0.w, r3.z, r0.w
      if b8
        dp3 r0.z, r2, r0
        min r3.y, r0.z, -c2.y
        min r2.w, c16.z, r0_abs.z
        cmp r2.w, -r0.z, r2.w, r3.y
        add r0.y, r3.z, c7.w
        pow r0.z, r2.w, r1.w
        mul_sat r0.z, r0.y, r0.z
        mul r4.xyz, r0.z, c7
      else
        mov r4.xyz, c2.z
      endif
      mul r5.xyz, r0.w, c3
    else
      mov r4.xyz, c2.z
      mov r5.xyz, r4.x
    endif

    if b1
      texld r0, v4, s3
      mul r3.xyz, v4, -c2.yyww
      nrm r0.xyz, r3
      dp3 r2.w, r1, r0
      min r3.x, r2.w, -c2.y
      min r3.y, c16.z, r2_abs.w
      mad_sat r3.z, r0.w, v4.w, c4.w
      cmp r0.w, -r2.w, r3.y, r3.x
      mul_sat r0.w, r3.z, r0.w
      if b9
        dp3 r0.z, r2, r0
        min r3.y, r0.z, -c2.y
        min r2.w, c16.z, r0_abs.z
        cmp r2.w, -r0.z, r2.w, r3.y
        add r0.y, r3.z, c8.w
        pow r0.z, r2.w, r1.w
        mul_sat r0.z, r0.y, r0.z
        mad r4.xyz, r0.z, c8, r4
      endif
      mad r5.xyz, r0.w, c4, r5
      mul r5.xyz, r5, c216.x               ; BOOST ONLY THIS LIGHT (b1) â€” tune c216 above
    endif

    if b2
      texld r0, v5, s3
      mul r3.xyz, v5, -c2.yyww
      nrm r0.xyz, r3
      dp3 r2.w, r1, r0
      min r3.x, r2.w, -c2.y
      min r3.y, c16.z, r2_abs.w
      mad_sat r3.z, r0.w, v5.w, c5.w
      cmp r0.w, -r2.w, r3.y, r3.x
      mul_sat r0.w, r3.z, r0.w
      if b10
        dp3 r0.z, r2, r0
        min r3.y, r0.z, -c2.y
        min r2.w, c16.z, r0_abs.z
        cmp r2.w, -r0.z, r2.w, r3.y
        add r0.y, r3.z, c9.w
        pow r0.z, r2.w, r1.w
        mul_sat r0.z, r0.y, r0.z
        mad r4.xyz, r0.z, c9, r4
      endif
      mad r5.xyz, r0.w, c5, r5
    endif

    if b3
      texld r0, v6, s3
      mul r3.xyz, v6, -c2.yyww
      nrm r0.xyz, r3
      dp3 r2.w, r1, r0
      min r3.x, r2.w, -c2.y
      min r3.y, c16.z, r2_abs.w
      mad_sat r3.z, r0.w, v6.w, c6.w
      cmp r0.w, -r2.w, r3.y, r3.x
      mul_sat r0.w, r3.z, r0.w
      if b11
        dp3 r0.z, r2, r0
        min r3.y, r0.z, -c2.y
        min r2.w, c16.z, r0_abs.z
        cmp r2.w, -r0.z, r2.w, r3.y
        add r0.y, r3.z, c10.w
        pow r0.z, r2.w, r1.w
        mul_sat r0.z, r0.y, r0.z
        mad r4.xyz, r0.z, c10, r4
      endif
      mad r5.xyz, r0.w, c6, r5
    endif

    if b4
      texld r0, v3.w, s4
      mul r3.xyz, v3, -c2.yyww
      nrm r6.xyz, r3
      dp3 r0.w, r1, r6
      min r3.y, r0.w, -c2.y
      min r2.w, c16.z, r0_abs.w
      mul r3.z, r0.x, v4.z
      cmp r2.w, -r0.w, r2.w, r3.y
      texldp r0, v4, s5
      mul r3.xyz, r3.z, r0
      if b14
        mul r0.xyz, r2.w, r3
        mul r0.xyz, r0, c4
        mad r5.xyz, r0, r3.w, r5
      else
        mul r0.xyz, r2.w, r3
        mad r5.xyz, r0, c4, r5
      endif
      if b9
        dp3 r0.w, r2, r6
        min r4.w, r0.w, -c2.y
        min r2.w, c16.z, r0_abs.w
        cmp r0.w, -r0.w, r2.w, r4.w
        pow r2.w, r0.w, r1.w
        texld r0, v3, s3
        add r0.w, r0.w, c8.w
        mul_sat r0.w, r2.w, r0.w
        if b14
          mul r0.xyz, r3, r0.w
          mul r0.xyz, r0, c8
          mad r4.xyz, r0, r3.w, r4
        else
          mul r0.xyz, r3, r0.w
          mad r4.xyz, r0, c8, r4
        endif
      endif
    endif

    if b5
      texld r0, v5.w, s4
      mul r6.xyz, v5, -c2.yyww
      nrm r3.xyz, r6
      dp3 r0.w, r1, r3
      min r1.x, r0.w, -c2.y
      min r1.y, c16.z, r0_abs.w
      mul r1.z, r0.x, v6.z
      cmp r2.w, -r0.w, r1.y, r1.x
      texldp r0, v6, s6
      mul r1.xyz, r1.z, r0
      if b15
        mul r0.xyz, r2.w, r1
        mul r0.xyz, r0, c5
        mad r5.xyz, r0, r3.w, r5
      else
        mul r0.xyz, r2.w, r1
        mad r5.xyz, r0, c5, r5
      endif
      if b10
        dp3 r0.w, r2, r3
        min r2.z, r0.w, -c2.y
        min r2.w, c16.z, r0_abs.w
        cmp r0.w, -r0.w, r2.w, r2.z
        pow r2.w, r0.w, r1.w
        texld r0, v5, s3
        add r0.w, r0.w, c9.w
        mul_sat r0.w, r2.w, r0.w
        if b15
          mul r0.xyz, r1, r0.w
          mul r0.xyz, r0, c9
          mad r4.xyz, r0, r3.w, r4
        else
          mul r0.xyz, r1, r0.w
          mad r4.xyz, r0, c9, r4
        endif
      endif
    endif

    mov r0.yz, c2
    cmp r4.w, -c211.y, -r0.z, -r0.y
    mov r7.xy, c0
    mad r3.xyz, c210.xyxw, r7.xyyw, v7.xyxw
    texld r1, r3, s12
    mad r2.xyz, c210.xyxw, r7.xxyw, v7.xyxw
    texld r0, r2, s12
    texld r3, r3.zyzw, s12
    texld r2, r2.zyzw, s12
    if_ne r4.w, -r4.w
      mad r3.w, r3.w, c11.x, c11.y
      exp r3.w, r3.w
      mul r6.xyz, r3, r3.w
      mad r2.w, r2.w, c11.x, c11.y
      exp r2.w, r2.w
      mad r1.w, r1.w, c11.x, c11.y
      mul r3.xyz, r2, r2.w
      exp r1.w, r1.w
      mad r1.xyz, r1, r1.w, -r6
      mad r0.w, r0.w, c11.x, c11.y
      mad r2.xy, v7, c210.zwzw, r7.x
      exp r0.w, r0.w
      frc r7.xy, r2
      mad r0.xyz, r0, r0.w, -r3
      mad r2.xyz, r7.x, r1, r6
      mad r1.xyz, r7.x, r0, r3
      lrp r0.yzw, r7.y, r1.xxyz, r2.xxyz
    else
      texld r0, v7, s12
      mul r0.yzw, r0.xxyz, c211.x
    endif

    log r0.x, r0.y
    log r0.y, r0.z
    log r0.z, r0.w
    mul r0.xyz, r0, c211.w
    exp r0.x, r0.x
    exp r0.y, r0.y
    exp r0.z, r0.z
    mad r1.xyz, r0, c211.x, r5

    texld r0, v0, s0
    mul r0, r0, c17
    mul r0.xyz, r1, r0

    if b12
      texld r1, v1, s2
      mad_sat r1.w, r1.z, c1.x, c1.y
      mad r0.xyz, r1.w, r4, r0
    endif

    if b13
      mov_sat r1.w, v2.w
      mul r1.w, r1.w, c12.w
      add r1.xyz, -r0, c12
      mad r0.xyz, r1.w, r1, r0
    endif

    mov oC0, r0

// approximately 315 instruction slots used (20 texture, 295 arithmetic)